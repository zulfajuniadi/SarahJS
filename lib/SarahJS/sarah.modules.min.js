define(["sarah","lodash"],function(){return{load:function(a,b,c){b(["sarah","app/"+a+"/"+a],function(b,d){var e=d.collections||{};_.each(e,function(a,c){b.Collections[c]=new b.Collection(c,a)});var f=d.templates||{},g="text!app/"+a+"/",h=[],i=_.map(f,function(a){return-1===h.indexOf(a.template)?(h.push(a.template),g+a.template):void 0});require(i,function(){_.each(arguments,function(a,c){var d=Object.keys(f)[c],e=new b.Template({html:a,name:d}),g=f[d].events||{};b.Utils.isFunction(f[d].after)&&(e.afterRender=f[d].after),b.Utils.isFunction(f[d].before)&&(e.beforeRender=f[d].before),e.events(g),b.Templates[d]=e}),b.Utils.publish("MODULE:LOAD:"+a),"undefined"!=typeof d.routes,b.Router(d.routes),c(d)})})}}});